<!DOCTYPE html>
<html lang="en">
<head>
  
  <title>Hello, AGOL!!!!</title>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="description" content="" />

  <!-- calls for the arcgis api's css file and js library-->

  <link rel="stylesheet" href="https://js.arcgis.com/4.25/esri/themes/light/main.css">
  <script src="https://js.arcgis.com/4.25/"></script>

  <!-- modules needed for full screen map -->
  <script>  
  require([
    "esri/config",
    "esri/Map",
    "esri/views/MapView",
    "esri/widgets/BasemapGallery",
    "esri/widgets/Expand",
    "esri/widgets/Locate",
    "esri/widgets/Search",
    // new modules for graphics lab 2 part 3
    "esri/Graphic",  
    "esri/layers/GraphicsLayer",
    // new module for feature layer lab 2 part 4
    "esri/layers/FeatureLayer",
    // new module for editing lab 3 part 3
    "esri/widgets/Editor",
    "esri/widgets/Legend"
  ], function(esriConfig, Map, MapView, BasemapGallery, Expand, Locate, Search, Graphic, GraphicsLayer, FeatureLayer, Editor, Legend) {   
  
    esriConfig.apiKey = "AAPTxy8BH1VEsoebNVZXo8HurBvZ7IXFuSOhRBuDgv645DOBpnCJ2vtGJsSqd0m31lu7G8oTSCniq7WBlH5N3K2i5Kk1zQ90Yxo4NRi0pv9a9tVhNCaTXh4UYBVSuMTZ4n-VHPYlh3hbIHglPgtC4dS9xt9DvdwtH300t76D_qaoPY1hHx-ZWazuU7A71NQteoVL5YMZ3d0qyiM8FhAB_8wsn9Lfxg-Z0qlqMFoRqQ2XStDdlWe0dU69PsLBWTeob7thAT1_t2Pq0hM2"
    
    const map = new Map({ 
      basemap: "streets-vector", // basemap layer service 
    });

    const view = new MapView({
      map: map,
      center: [-97.7335, 30.2550], // longitude, latitude **(updated to my alma mater - UT Autsin)
      scale: 75000, // **(updated from zoom to scale; set to encompass all of main campus)
      container: "viewDiv" // div element
    });

    const basemapGallery = new BasemapGallery({ //default Basemap Gallery Widget
      view: view,
    });

    const expand = new Expand({ //put basemap gallery widget in an expandable tab
        view: view,
        content: basemapGallery 
    });
    view.ui.add(expand, "top-right"); //set expandable tab in top-right of map

    const locate = new Locate({ //locate Widget
      view: view
    });
    view.ui.add(locate, {
      position: "bottom-left" //set locate widget in bottom-left of map
    });
    
    const search = new Search({ //search Widget
      view: view
    });
    view.ui.add(search, {
      position: "top-left", //set search widget in top-left of map
      index: 2
    });
    
    // lab 2 part 3
    // constructor for graphics layer 
    const graphicsLayer = new GraphicsLayer();  
    map.add(graphicsLayer);
    
    // geometry of the pt
    const point = { //Create a point  
    type: "point",  
    longitude: -97.7357,    //long lat of JGB
    latitude: 30.2858
    };
    // marker style
    const simpleMarkerSymbol = {  
    type: "simple-marker",
    style: "x",
    size: "8px",  
    outline: {  
      color: [204, 85, 0], // burnt orange  
      width: 2
      }  
    };
    // define popup properties
    const PtpopupTemplate = {
    title: "{Name}",
    content: "{Description}"
    };
    const ptAttributes = {
    Name: "Jackson School of Geosciences",
    Description: "Home of the UT - Austin geology department"
    };
    // create the pt
    const pointGraphic = new Graphic({  
    geometry: point,  
    symbol: simpleMarkerSymbol,
    attributes: ptAttributes,
    popupTemplate: PtpopupTemplate  
    });
    //add pt to graphics layer
    graphicsLayer.add(pointGraphic);

    // polyline geometry
    const polyline = {
      type: "polyline",
      paths: [
        [-97.7782, 30.2843],
        [-97.7357, 30.2858]
      ]
    };
    // polyline marker style
    const simpleLineSymbol = {
      type: "simple-line",
      color: "brown",
      width: 1,
      style: "dot"
    };
     // polyline graphic
    const polylineGraphic = new Graphic({
      geometry: polyline,
      symbol: simpleLineSymbol
    });
    // add polyline to graphics layer
    graphicsLayer.add(polylineGraphic);

    // polygon geometry
    const polygon = {
      type: "polygon",
      rings: [
        [-97.775569, 30.280904],
        [-97.780298, 30.287658],
        [-97.783298, 30.284200],
        [-97.777724, 30.279288],
        [-97.775569, 30.280904]
      ]
    };
    // polygon popup properties
    const polyPopupTemplate = {
      title: "{Name}",
      content: "{Description}"
    };
    const polyAttributes = {
    Name: "Brackenridge Field Laboratory",
    Description: "An urban field station for ecology research"
    };
    // polygon fill style
    const simpleFillSymbol = {
      type: "simple-fill",
      color: [204, 85, 0, 0.5],
      style: "solid",
      outline: {
        width: 0
      }
    };
    // polygon graphic
    const polygonGraphic = new Graphic({
      geometry: polygon,
      symbol: simpleFillSymbol,
      attributes: polyAttributes,
      popupTemplate: polyPopupTemplate 
    });
    // add polygon to graphics layer
    graphicsLayer.add(polygonGraphic);

    // lab 2 part 4:
    // Define a pop-up for usaeduLayer
    const popupEduusa = {
      "title": "College Information",
      "content": "<b>Name:</b> {INSTNM}<br> <b>Address:</b> {ADDR} - {CITY} , {STABBR}  {ZIP} <br> <b>Enrollment:</b> {INSTSIZE} <br> <a href={WEBADDR}>Institution Website</a>"
    };
    //adding the Const for the feature layer
    const usaeduLayer = new FeatureLayer({
      url: "https://services2.arcgis.com/FiaPA4ga0iQKduv3/arcgis/rest/services/Colleges_and_Universities_View/FeatureServer",
    //adding the popup here
      popupTemplate: popupEduusa
    });
    //adding the feature layer to the map
    map.add(usaeduLayer);

    // lab 2 part 5, 6:
    const airportRenderer = {
      "type": "unique-value",
      "field": "Fac_Type",
      "uniqueValueInfos": [{
        "value": 'AIRPORT',
        "symbol": {
          "type": "picture-marker",
          "url": "https://kmlitchen.github.io/576_agol/plane-icon.png",
          "width": "14px",
          "height": "14px"
          }
        },{
        "value": 'HELIPORT',
        "symbol": {
          "type": "picture-marker",
          "url": "https://kmlitchen.github.io/576_agol/helipad-black-icon.png",
          "width": "14px",
          "height": "14px"
          }
        }]
      };
    //const to make the airport labels
    const airportLabels = {
      symbol: {
        type: "text",
        color: "#ff5c33",
        font: {
          size: "10px",
          family: "Noto Sans",
          style: "italic",
          weight: "normal"
        }
      },
      labelPlacement: "above-right",
      labelExpressionInfo: {
        expression: "$feature.Fac_Name"
      }
    };
    const airportLayer = new FeatureLayer({
      url: "https://services.arcgis.com/HRPe58bUyBqyyiCt/arcgis/rest/services/576_US_Airports/FeatureServer",
      renderer: airportRenderer,
      //definitionExpression: "Fac_Type = 'AIRPORT'", //adding sql to filter for airports
      labelingInfo: [airportLabels] //adding the labels
    });
    
    map.add(airportLayer);
    
    // lab 3 part 3:
    //adding the const for the feature layer
    //const to make my airport labels - challenge 2
    const myAirportLabels = {
      symbol: {
        type: "text",
        color: "#ff5c33",
        haloColor: "#ff5c33",
        haloSize: "1px",
        font: {
          size: "16px",
          family: "Noto Sans",
          style: "bold",
          weight: "normal"
        }
      },
      labelPlacement: "below-center",
      labelExpressionInfo: {
        expression: "$feature.AirportCode"
      }
    };
    // const to make my airport symbols - challenge 1
    const myAirportRenderer = {
        "type": "simple",
        "symbol": {
          "type": "picture-marker",
          "url": "https://kmlitchen.github.io/576_agolrest/check.png",
          "width": "30px",
          "height": "30px"
        }
      }
    const myAirports = new FeatureLayer({
      url: "https://services.arcgis.com/HRPe58bUyBqyyiCt/arcgis/rest/services/576_My_Airports/FeatureServer",
      //adding the popup here
      outFields: ["AirportCode"],
      labelingInfo: [myAirportLabels],
      renderer: myAirportRenderer
    });
    //adding the feature layer to the map
    map.add(myAirports);

    // Set the point layer's LayerInfo
    const pointInfos = {
      layer: myAirports
    }

    // Begin Editor constructor
    const editor = new Editor({
      view: view,
      layerInfos: [pointInfos]
    }); // End Editor constructor

    const editorExpand = new Expand({ //put editor in an expandable tab
        view: view,
        content: editor
    });
    view.ui.add(editorExpand, "top-right"); //set expandable tab in top-right of map

    // lab 3 chalenge 3 - add legend
    const myLegend = new Legend ({
      view: view,
      layerInfos: [{layer: myAirports},{layer: airportLayer}],
    });
    const legendExpand = new Expand ({
      view: view,
      content: myLegend
    })
    view.ui.add(legendExpand, "bottom-right"); // put legend in expandable tab
  });  
  </script>

  <!-- css to make a full screen map -->
  <style>  
    html,  
    body,  
    #viewDiv {
      padding: 0;
      margin: 0;  
      height: 100%;  
      width: 100%;  
    }  
  </style>

</head>

<body>
  <!-- div to display the map-->
  <div id="viewDiv"></div> 

</body>

</html>
